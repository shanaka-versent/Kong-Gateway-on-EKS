# Kong Plugins for Users API
# @author Shanaka Jayasundera - shanakaj@gmail.com
#
# These plugins demonstrate Kong's API management capabilities:
# - Rate limiting to prevent abuse
# - Request transformation to add headers
# - CORS for browser-based API access

---
# Rate Limiting Plugin
# Limits requests to 100 per minute per client IP
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: rate-limiting
  namespace: api
config:
  minute: 100
  policy: local
  limit_by: ip
  hide_client_headers: false
plugin: rate-limiting

---
# Request Transformer Plugin
# Adds custom headers to requests
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: request-transformer
  namespace: api
config:
  add:
    headers:
      - "X-Request-ID:$(uuid)"
      - "X-Forwarded-Proto:https"
      - "X-Kong-Proxy:true"
plugin: request-transformer

---
# CORS Plugin
# Enables cross-origin requests for browser-based API access
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: cors
  namespace: api
config:
  origins:
    - "*"
  methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
  headers:
    - Content-Type
    - Authorization
    - X-Request-ID
  exposed_headers:
    - X-RateLimit-Limit-Minute
    - X-RateLimit-Remaining-Minute
  max_age: 3600
  credentials: false
plugin: cors

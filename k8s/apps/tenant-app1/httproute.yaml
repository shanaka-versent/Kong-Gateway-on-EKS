# Sample App 1 HTTPRoute
# @author Shanaka Jayasundera - shanakaj@gmail.com
#
# Routes /app1/* paths to the sample-app-1 service.
# No Kong plugins applied - clean pass-through.

apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: app1-route
  namespace: tenant-app1
  # No konghq.com/plugins annotation = clean pass-through
spec:
  parentRefs:
    - name: kong-gateway
      namespace: kong
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /app1
      backendRefs:
        - name: sample-app-1
          port: 8080

---
# ReferenceGrant allows Kong Gateway to route to services in tenant-app1 namespace
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: allow-kong-gateway
  namespace: tenant-app1
spec:
  from:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      namespace: tenant-app1
  to:
    - group: ""
      kind: Service

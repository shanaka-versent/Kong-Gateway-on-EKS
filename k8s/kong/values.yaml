# Kong Ingress Controller Helm Values
# @author Shanaka Jayasundera - shanakaj@gmail.com
#
# This values file configures Kong Gateway with Gateway API support.

# Enable Gateway API support
gateway:
  enabled: true

# Kong Ingress Controller configuration
ingressController:
  enabled: true
  installCRDs: false  # We install Gateway API CRDs separately

  # Enable Gateway API support
  env:
    feature_gates: "GatewayAlpha=true"

# Kong Gateway (Data Plane) configuration
# NLB is managed by Terraform for CloudFront VPC Origin integration.
# Kong pods are registered with the NLB target group via TargetGroupBinding CRD
# (provided by AWS Load Balancer Controller).
proxy:
  enabled: true
  type: ClusterIP  # NLB is Terraform-managed, not auto-created by LB Controller

  # NOTE: AWS NLB annotations removed - NLB is now Terraform-managed
  # The TargetGroupBinding CRD registers Kong pod IPs with the
  # Terraform-managed NLB target group automatically

  http:
    enabled: true
    containerPort: 8000
    servicePort: 80

  tls:
    enabled: false

# Admin API (disabled for production)
admin:
  enabled: false

# Status endpoint for health checks
status:
  enabled: true
  http:
    enabled: true
    containerPort: 8100

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Tolerations for system node pool
tolerations:
  - key: "CriticalAddonsOnly"
    operator: "Exists"
    effect: "NoSchedule"

# Pod anti-affinity for HA
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Replica count
replicaCount: 2
